"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9816:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>I,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var a={};t.r(a),t.d(a,{GET:()=>u,dynamic:()=>c});var s=t(9303),i=t(8716),o=t(670),n=t(7070),l=t(7982);let c="force-dynamic";async function u(e){try{let r=e.nextUrl.searchParams,t=r.get("q"),a=r.get("type")||"all",s=parseInt(r.get("limit")||"20");if(!t||t.trim().length<2)return n.NextResponse.json({error:"搜索关键词至少需要2个字符"},{status:400});let i=t.trim(),o={};if("all"===a||"modules"===a){let{data:e,error:r}=await l.O.from("modules").select("*").or(`name.ilike.%${i}%,author.ilike.%${i}%,system.ilike.%${i}%,description.ilike.%${i}%`).order("created_at",{ascending:!1}).limit(s);r?console.error("模组搜索错误:",r):o.modules=e||[]}if("all"===a||"tags"===a){let{data:e,error:r}=await l.O.from("tag_categories").select("*").ilike("name",`%${i}%`).limit(s),{data:t,error:a}=await l.O.from("tag_subcategories").select(`
          *,
          tag_categories (
            id,
            name
          )
        `).ilike("name",`%${i}%`).limit(s);r&&console.error("分类搜索错误:",r),a&&console.error("子标签搜索错误:",a),o.tags={categories:e||[],subcategories:t||[]}}return n.NextResponse.json({query:i,results:o,total:{modules:o.modules?.length||0,categories:o.tags?.categories?.length||0,subcategories:o.tags?.subcategories?.length||0}})}catch(e){return console.error("搜索错误:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"/home/runner/work/rw-webapp/rw-webapp/src/app/api/search/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:g}=p,h="/api/search/route";function I(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},7982:(e,r,t)=>{t.d(r,{O:()=>o});let a=require("@supabase/supabase-js"),s="https://eguhisfzeimoivfmikgb.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVndWhpc2Z6ZWltb2l2Zm1pa2diIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzOTMzNzEsImV4cCI6MjA3MDk2OTM3MX0.3E8MD1a8SebcCo2IDQmXd9BFv18zh1213eGfZ-3EcD0",o=(0,a.createClient)(s,i);(0,a.createClient)(s,process.env.SUPABASE_SERVICE_ROLE_KEY||i)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972],()=>t(9816));module.exports=a})();