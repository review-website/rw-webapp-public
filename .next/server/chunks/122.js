exports.id=122,exports.ids=[122],exports.modules={9549:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},6121:()=>{},434:(e,t,s)=>{"use strict";s.d(t,{default:()=>i.a});var r=s(9404),i=s.n(r)},9837:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var r=s(326),i=s(1223);let o=(0,s(7577).forwardRef)(({className:e,variant:t="primary",size:s="md",...o},a)=>r.jsx("button",{className:(0,i.cn)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700":"primary"===t,"bg-gray-100 text-gray-900 hover:bg-gray-200":"secondary"===t,"border border-gray-300 bg-white text-gray-900 hover:bg-gray-50":"outline"===t,"text-gray-900 hover:bg-gray-100":"ghost"===t},{"h-8 px-3 text-sm":"sm"===s,"h-10 px-4":"md"===s,"h-12 px-6 text-lg":"lg"===s},e),ref:a,...o}));o.displayName="Button"},5329:(e,t,s)=>{"use strict";s.d(t,{Ol:()=>n,Zb:()=>a,aY:()=>d,ll:()=>l});var r=s(326),i=s(1223),o=s(7577);let a=(0,o.forwardRef)(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,i.cn)("rounded-lg border bg-white shadow-sm",e),...t}));a.displayName="Card";let n=(0,o.forwardRef)(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));n.displayName="CardHeader";let l=(0,o.forwardRef)(({className:e,...t},s)=>r.jsx("h3",{ref:s,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",e),...t}));l.displayName="CardTitle";let d=(0,o.forwardRef)(({className:e,...t},s)=>r.jsx("div",{ref:s,className:(0,i.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent"},1223:(e,t,s)=>{"use strict";s.d(t,{AC:()=>g,Fp:()=>f,Sp:()=>m,cn:()=>o,i$:()=>y,j2:()=>n,mJ:()=>l,p6:()=>h,tv:()=>d,u3:()=>u,xV:()=>c,xv:()=>a});var r=s(1135),i=s(1009);function o(...e){return(0,i.m6)((0,r.W)(e))}function a(){return crypto.randomUUID()}function n(e,t){}function l(){return[]}function d(e){return[].find(t=>t.moduleId===e)||null}function c(e){return null!==d(e)}function u(e){}function m(e=30){}function g(){let e=[],t=e.length,s=new Set(e.map(e=>e.moduleId)).size,r=e.length>0?Math.min(...e.map(e=>e.timestamp)):null;return{totalVotes:t,uniqueModules:s,oldestVote:r?new Date(r):null,sessionId:a()}}function h(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function y(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function f(e,t){return 0===t?0:Math.round(e/t*100)}},6137:(e,t,s)=>{"use strict";s.d(t,{LM:()=>o.useUserStore,Lb:()=>i.useVotingStore,kI:()=>r.useModulesStore});var r=s(7358),i=s(1382),o=s(845)},7358:(e,t,s)=>{"use strict";s.r(t),s.d(t,{useModulesStore:()=>o});var r=s(8408);let i={modules:[],pagination:{page:1,limit:20,total:0,totalPages:0},searchQuery:"",loading:!1,error:null},o=(0,r.U)((e,t)=>({...i,setModules:t=>e({modules:t}),setPagination:t=>e({pagination:t}),setSearchQuery:t=>e({searchQuery:t}),setLoading:t=>e({loading:t}),setError:t=>e({error:t}),fetchModules:async(e=1,s="")=>{let{setLoading:r,setError:i,setModules:o,setPagination:a}=t();r(!0),i(null);try{let t=new URLSearchParams({page:e.toString(),limit:"20"});s.trim()&&t.append("search",s.trim());let r=await fetch(`/api/modules?${t.toString()}`);if(!r.ok)throw Error("获取模组列表失败");let i=await r.json();o(i.modules),a(i.pagination)}catch(e){i(e instanceof Error?e.message:"未知错误"),o([])}finally{r(!1)}},searchModules:async e=>{let{setSearchQuery:s,setPagination:r,fetchModules:i}=t();s(e),r({...t().pagination,page:1}),await i(1,e)},goToPage:async e=>{let{setPagination:s,fetchModules:r,searchQuery:i}=t();s({...t().pagination,page:e}),await r(e,i)},refresh:async()=>{let{pagination:e,searchQuery:s,fetchModules:r}=t();await r(e.page,s)},reset:()=>e(i)}))},845:(e,t,s)=>{"use strict";s.r(t),s.d(t,{useUserStore:()=>a});var r=s(8408),i=s(1223);let o={isAuthenticated:!1,userId:null,username:null,email:null,voteHistory:[],voteStats:{totalVotes:0,uniqueModules:0,oldestVote:null,sessionId:""},historyLoading:!1},a=(0,r.U)((e,t)=>({...o,setAuthenticated:t=>e({isAuthenticated:t}),setUser:t=>e({isAuthenticated:!!t,userId:t?.id||null,username:t?.username||null,email:t?.email||null}),setVoteHistory:t=>e({voteHistory:t}),addVoteToHistory:s=>{let{voteHistory:r}=t(),i=r.findIndex(e=>e.moduleId===s.moduleId);if(i>=0){let t=[...r];t[i]=s,e({voteHistory:t})}else e({voteHistory:[...r,s]})},removeVoteFromHistory:s=>{let{voteHistory:r}=t();e({voteHistory:r.filter(e=>e.moduleId!==s)})},clearVoteHistory:()=>e({voteHistory:[]}),loadVoteHistory:()=>{e({historyLoading:!0});try{let t=(0,i.mJ)(),s=(0,i.AC)();e({voteHistory:t,voteStats:s,historyLoading:!1})}catch(t){console.error("加载本地投票历史失败:",t),e({historyLoading:!1})}},removeVote:e=>{(0,i.u3)(e);let{loadVoteHistory:s}=t();s()},cleanupOldData:(e=30)=>{(0,i.Sp)(e);let{loadVoteHistory:s}=t();s()},reset:()=>e(o)}))},1382:(e,t,s)=>{"use strict";s.r(t),s.d(t,{useVotingStore:()=>a});var r=s(8408),i=s(1223);let o={selectedSubcategories:[],isSubmitting:!1,isLoadingPreviousVote:!1,hasVoted:!1,existingVote:null},a=(0,r.U)((e,t)=>({...o,setSelectedSubcategories:t=>e({selectedSubcategories:t}),setSubmitting:t=>e({isSubmitting:t}),setLoadingPreviousVote:t=>e({isLoadingPreviousVote:t}),setHasVoted:t=>e({hasVoted:t}),setExistingVote:t=>e({existingVote:t}),toggleSubcategory:s=>{let{selectedSubcategories:r}=t();e({selectedSubcategories:r.includes(s)?r.filter(e=>e!==s):[...r,s]})},loadPreviousVote:async e=>{let{setLoadingPreviousVote:s,setExistingVote:r,setSelectedSubcategories:o}=t(),a=(0,i.tv)(e);if(a){r(a),s(!0);try{let t=await fetch(`/api/tags/votes/user?module_id=${e}&session_id=${a.sessionId}`);if(t.ok){let e=await t.json();if(Array.isArray(e)&&e.length>0){let t=e.map(e=>e.subcategory_id);o(t)}}}catch(e){console.error("获取历史投票数据失败:",e)}finally{s(!1)}}},submitVote:async(e,s,r)=>{let{selectedSubcategories:o,existingVote:a,setSubmitting:n,setHasVoted:l,setExistingVote:d,setSelectedSubcategories:c}=t();if(0===o.length)throw Error("请选择至少一个标签");n(!0);try{if(a){let t=await fetch("/api/tags/votes",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({module_id:e,session_id:a.sessionId})});if(!t.ok){let e=await t.json();throw Error(e.error||"删除旧投票记录失败")}(0,i.u3)(e)}let t=a?.sessionId||(0,i.xv)(),n=await fetch("/api/tags/votes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({module_id:e,subcategory_ids:o,session_id:t})});if(!n.ok){let e=await n.json();throw Error(e.error||"投票提交失败")}let u=r.filter(e=>o.includes(e.id)),m=u.map(e=>e.category?.name).filter(e=>!!e),g=Array.from(new Set(m)),h={moduleId:e,moduleName:s,subcategoryIds:o,subcategoryNames:u.map(e=>e.name),categoryName:g.join(", "),sessionId:t};return(0,i.j2)(h),l(!0),d({...h,sessionId:t,timestamp:Date.now()}),c([]),await n.json()}catch(e){throw console.error("投票提交失败:",e),e}finally{n(!1)}},revote:async e=>{let{existingVote:s,setSubmitting:r,setHasVoted:i,setExistingVote:o,setSelectedSubcategories:a}=t();if(s){r(!0);try{let r=await fetch("/api/tags/votes",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({module_id:e,session_id:s.sessionId})});if(!r.ok){let e=await r.json();throw Error(e.error||"删除投票记录失败")}let n=s.subcategoryIds||[],l=JSON.parse(localStorage.getItem("userVoteHistory")||"[]").filter(t=>!(t.moduleId===e&&t.sessionId===s.sessionId));localStorage.setItem("userVoteHistory",JSON.stringify(l)),i(!1),o(null),0===t().selectedSubcategories.length&&n.length>0&&a(n)}catch(e){console.error("重新投票失败:",e),alert(e instanceof Error?e.message:"重新投票失败")}finally{r(!1)}}},reset:()=>e(o)}))},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,metadata:()=>i});var r=s(9510);s(5023);let i={title:"TRPG模组厌女要素标记平台",description:"识别和标记TRPG模组中的厌女要素"};function o({children:e}){return r.jsx("html",{lang:"zh-CN",children:(0,r.jsxs)("body",{className:"min-h-screen ",children:[r.jsx("header",{className:"",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[r.jsx("div",{className:"flex items-center",children:r.jsx("h1",{className:"text-xl font-semibold",children:"TRPG模组评价平台"})}),(0,r.jsxs)("nav",{className:"flex items-center space-x-4",children:[r.jsx("a",{href:"/",className:"text-gray-700 hover:text-gray-900",children:"首页"}),r.jsx("a",{href:"/modules",className:"text-gray-700 hover:text-gray-900",children:"模组"}),r.jsx("a",{href:"/profile",className:"text-gray-700 hover:text-gray-900",children:"个人中心"}),r.jsx("a",{href:"/admin",className:"text-gray-700 hover:text-gray-900",children:"管理"})]})]})})}),r.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e})]})})}},5023:()=>{},8408:(e,t,s)=>{"use strict";s.d(t,{U:()=>l});var r=s(7577);let i=e=>{let t;let s=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),s.forEach(s=>s(t,e))}},i=()=>t,o={setState:r,getState:i,getInitialState:()=>a,subscribe:e=>(s.add(e),()=>s.delete(e))},a=t=e(r,i,o);return o},o=e=>e?i(e):i,a=e=>e,n=e=>{let t=o(e),s=e=>(function(e,t=a){let s=r.useSyncExternalStore(e.subscribe,r.useCallback(()=>t(e.getState()),[e,t]),r.useCallback(()=>t(e.getInitialState()),[e,t]));return r.useDebugValue(s),s})(t,e);return Object.assign(s,t),s},l=e=>e?n(e):n}};