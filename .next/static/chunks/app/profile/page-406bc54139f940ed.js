(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{6147:function(e,s,t){Promise.resolve().then(t.bind(t,1386))},1386:function(e,s,t){"use strict";t.d(s,{VoteHistory:function(){return x}});var l=t(7437),a=t(757),r=t(6334),c=t(2265),i=t(2893),n=t(3448),d=t(7648);function x(){let{voteHistory:e,groupedByModule:s,stats:t,loading:x,removeVote:m,cleanupOldData:o}=function(){let{voteHistory:e,voteStats:s,historyLoading:t,loadVoteHistory:l,removeVote:a,cleanupOldData:r}=(0,i.LM)();return(0,c.useEffect)(()=>{l()},[l]),{voteHistory:e.sort((e,s)=>s.timestamp-e.timestamp),groupedByModule:e.reduce((e,s)=>{let t=s.moduleId;return e[t]||(e[t]=[]),e[t].push(s),e},{}),stats:s,loading:t,loadHistory:l,removeVote:a,cleanupOldData:r}}();return x?(0,l.jsx)(a.Zb,{children:(0,l.jsx)(a.aY,{className:"p-6",children:(0,l.jsx)("div",{className:"text-center",children:"正在加载投票历史..."})})}):0===e.length?(0,l.jsxs)(a.Zb,{children:[(0,l.jsx)(a.Ol,{children:(0,l.jsx)(a.ll,{children:"投票历史"})}),(0,l.jsx)(a.aY,{children:(0,l.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,l.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012-2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),(0,l.jsx)("p",{className:"text-lg mb-2",children:"暂无投票记录"}),(0,l.jsx)("p",{className:"text-sm",children:"去为模组投票吧！"}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(d.default,{href:"/modules",children:(0,l.jsx)(r.z,{children:"浏览模组"})})})]})})]}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(a.Zb,{children:[(0,l.jsx)(a.Ol,{children:(0,l.jsx)(a.ll,{children:"投票统计"})}),(0,l.jsxs)(a.aY,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:t.totalVotes}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"总投票数"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-green-600",children:t.uniqueModules}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"投票模组"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:t.oldestVote?Math.ceil((Date.now()-t.oldestVote.getTime())/864e5):0}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"活跃天数"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsxs)("div",{className:"text-xs text-gray-500 break-all",children:["会话ID: ",t.sessionId.slice(0,8),"..."]}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"匿名标识"})]})]}),(0,l.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,l.jsx)(r.z,{variant:"outline",size:"sm",onClick:()=>o(30),className:"text-xs",children:"清理30天前的数据"})})]})]}),(0,l.jsxs)(a.Zb,{children:[(0,l.jsxs)(a.Ol,{children:[(0,l.jsx)(a.ll,{children:"投票记录"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"按时间倒序排列"})]}),(0,l.jsx)(a.aY,{children:(0,l.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,l.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,l.jsx)(d.default,{href:"/modules/".concat(e.moduleId),className:"font-medium text-blue-600 hover:text-blue-800 transition-colors",children:e.moduleName}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500",children:(0,n.i$)(e.timestamp)}),(0,l.jsx)(r.z,{variant:"ghost",size:"sm",onClick:()=>{confirm("确定要删除这条投票记录吗？")&&m(e.moduleId)},className:"text-red-600 hover:text-red-800 p-1 h-auto",children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("span",{className:"font-medium text-gray-700",children:"分类: "}),(0,l.jsx)("span",{className:"text-gray-600",children:e.categoryName})]}),(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsx)("span",{className:"font-medium text-gray-700",children:"标签: "}),(0,l.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:e.subcategoryNames.map(e=>(0,l.jsx)("span",{className:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:e},e))})]})]})]},"".concat(e.moduleId,"-").concat(e.timestamp)))})})]}),(0,l.jsxs)(a.Zb,{children:[(0,l.jsx)(a.Ol,{children:(0,l.jsx)(a.ll,{children:"按模组分组"})}),(0,l.jsx)(a.aY,{children:(0,l.jsx)("div",{className:"space-y-4",children:Object.entries(s).map(e=>{let[s,t]=e,a=t[0];return(0,l.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)(d.default,{href:"/modules/".concat(s),className:"font-medium text-blue-600 hover:text-blue-800",children:a.moduleName}),(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:[t.length," 次投票"]})]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,l.jsx)("span",{className:"font-medium",children:"最近投票: "}),a.categoryName," - ",a.subcategoryNames.join(", ")]}),(0,l.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:(0,n.i$)(a.timestamp)})]},s)})})})]})]})}}},function(e){e.O(0,[216,764,744],function(){return e(e.s=6147)}),_N_E=e.O()}]);