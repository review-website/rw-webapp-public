(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{2454:function(e,s,l){Promise.resolve().then(l.bind(l,6447))},6447:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return x}});var a=l(7437),t=l(2265),c=l(6334),r=l(757),n=l(2893);function i(e){let{moduleId:s,moduleName:l,onVoteSubmitted:i}=e,[d,x]=(0,t.useState)([]),[h,m]=(0,t.useState)(!0),[o,j]=(0,t.useState)(null),{selectedSubcategories:u,isSubmitting:f,isLoadingPreviousVote:N,hasVoted:p,existingVote:g,toggleSubcategory:b,submitVote:y,revote:v,loadPreviousVote:w}=(0,n.Lb)();(0,t.useEffect)(()=>{w(s)},[s,w]),(0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/tags/categories");if(!e.ok)throw Error("获取标签分类失败");let s=await e.json();x(s)}catch(e){j(e instanceof Error?e.message:"未知错误")}finally{m(!1)}})()},[]);let k=async()=>{try{let e=d.flatMap(e=>e.tag_subcategories||[]).filter(e=>u.includes(e.id));await y(s,l,e),null==i||i()}catch(e){j(e instanceof Error?e.message:"投票提交失败")}};return h?(0,a.jsx)(r.Zb,{children:(0,a.jsx)(r.aY,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"正在加载标签分类..."})})}):o?(0,a.jsx)(r.Zb,{children:(0,a.jsx)(r.aY,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center text-red-600",children:o})})}):p&&g?(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsx)(r.ll,{className:"text-green-600",children:"✓ 您已为此模组投票"})}),(0,a.jsxs)(r.aY,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"投票分类:"})," ",g.categoryName]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"选择的标签:"})," ",g.subcategoryNames.join(", ")]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"投票时间:"})," ",new Date(g.timestamp).toLocaleString("zh-CN")]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(c.z,{variant:"outline",onClick:()=>v(s),children:"重新投票"})})]})]}):(0,a.jsxs)(r.Zb,{children:[(0,a.jsxs)(r.Ol,{children:[(0,a.jsx)(r.ll,{children:"选择标签"}),(0,a.jsx)("p",{className:"text-gray-600",children:"可以选择多个分类下的标签来标记模组中的厌女要素"}),N&&(0,a.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:"正在加载您之前的投票选择..."})]}),(0,a.jsx)(r.aY,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[d.map(e=>(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"font-semibold text-lg text-gray-900 border-b border-gray-200 pb-2",children:[e.name,e.description&&(0,a.jsxs)("span",{className:"text-sm font-normal text-gray-600 ml-2",children:["- ",e.description]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 pl-4",children:(e.tag_subcategories||[]).map(e=>(0,a.jsx)("button",{onClick:()=>b(e.id),className:"p-3 text-left border rounded-lg transition-colors ".concat(u.includes(e.id)?"border-blue-500 bg-blue-50 text-blue-900":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded border mr-3 flex items-center justify-center ".concat(u.includes(e.id)?"bg-blue-500 border-blue-500":"border-gray-300"),children:u.includes(e.id)&&(0,a.jsx)("span",{className:"text-white text-xs",children:"✓"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:e.name}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})]})},e.id))})]},e.id)),(0,a.jsx)("div",{className:"flex justify-end items-center pt-4 border-t",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["已选择 ",u.length," 个标签"]}),(0,a.jsx)(c.z,{onClick:k,disabled:0===u.length||f,children:f?"提交中...":"确认提交"})]})})]})})]})}var d=l(7648);function x(e){let{params:s}=e,[l,n]=(0,t.useState)(null),[x,h]=(0,t.useState)(!0);return((0,t.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/modules/".concat(s.moduleId),{cache:"no-store"});if(e.ok){let s=await e.json();n(s)}}catch(e){console.error("获取模组数据失败:",e)}finally{h(!1)}})()},[s.moduleId]),x)?(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(r.Zb,{children:(0,a.jsx)(r.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"text-gray-600",children:"正在加载模组信息..."})})})}):l?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,a.jsxs)("nav",{className:"text-sm text-gray-600",children:[(0,a.jsx)(d.default,{href:"/",className:"hover:text-gray-900",children:"首页"}),(0,a.jsx)("span",{className:"mx-2",children:"/"}),(0,a.jsx)(d.default,{href:"/modules",className:"hover:text-gray-900",children:"模组"}),(0,a.jsx)("span",{className:"mx-2",children:"/"}),(0,a.jsx)(d.default,{href:"/modules/".concat(l.id),className:"hover:text-gray-900",children:l.name}),(0,a.jsx)("span",{className:"mx-2",children:"/"}),(0,a.jsx)("span",{className:"text-gray-900",children:"投票"})]}),(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsxs)(r.ll,{children:["为 “",l.name,"” 投票"]})}),(0,a.jsx)(r.aY,{children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("p",{className:"text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"作者:"})," ",l.author,l.system&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"mx-2",children:"|"}),(0,a.jsx)("span",{className:"font-medium",children:"系统:"})," ",l.system]})]})}),(0,a.jsx)(d.default,{href:"/modules/".concat(l.id),children:(0,a.jsx)(c.z,{variant:"outline",size:"sm",children:"查看详情"})})]})})]}),(0,a.jsx)(i,{moduleId:l.id,moduleName:l.name,onVoteSubmitted:()=>{window.location.href="/modules/".concat(l.id)}}),(0,a.jsxs)(r.Zb,{children:[(0,a.jsx)(r.Ol,{children:(0,a.jsx)(r.ll,{className:"text-lg",children:"投票说明"})}),(0,a.jsx)(r.aY,{children:(0,a.jsxs)("div",{className:"space-y-3 text-sm text-gray-600",children:[(0,a.jsx)("p",{children:"• 您的投票完全匿名，其他用户无法看到您的身份"}),(0,a.jsx)("p",{children:"• 每个模组只能投票一次，但可以选择多个标签"}),(0,a.jsx)("p",{children:"• 投票记录会保存在您的浏览器本地，便于查看历史"}),(0,a.jsx)("p",{children:"• 如需修改投票，可以重新投票覆盖之前的选择"}),(0,a.jsx)("p",{children:"• 请根据模组实际内容进行客观投票"})]})})]})]}):(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsx)(r.Zb,{children:(0,a.jsxs)(r.aY,{className:"p-8 text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"模组不存在"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"抱歉，您查找的模组不存在或已被删除。"}),(0,a.jsx)(d.default,{href:"/modules",children:(0,a.jsx)(c.z,{children:"返回模组列表"})})]})})})}}},function(e){e.O(0,[216,764,744],function(){return e(e.s=2454)}),_N_E=e.O()}]);