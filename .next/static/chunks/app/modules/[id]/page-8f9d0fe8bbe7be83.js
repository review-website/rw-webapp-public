(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{6496:function(e,t,n){Promise.resolve().then(n.t.bind(n,2972,23)),Promise.resolve().then(n.bind(n,5926))},757:function(e,t,n){"use strict";n.d(t,{Ol:function(){return l},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var r=n(7437),s=n(3448),a=n(2265);let i=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-white shadow-sm",n),...a})});i.displayName="Card";let l=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",n),...a})});l.displayName="CardHeader";let c=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight",n),...a})});c.displayName="CardTitle";let o=(0,a.forwardRef)((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",n),...a})});o.displayName="CardContent"},5926:function(e,t,n){"use strict";n.d(t,{VoteResults:function(){return l}});var r=n(7437),s=n(2265),a=n(757),i=n(3448);function l(e){let{moduleId:t,refreshKey:n}=e,[l,c]=(0,s.useState)([]),[o,u]=(0,s.useState)(!0),[d,f]=(0,s.useState)(null),[m,h]=(0,s.useState)(0),x=(0,s.useCallback)(async()=>{try{u(!0);let e=await fetch("/api/tags/votes?module_id=".concat(t),{cache:"no-store"});if(!e.ok)throw Error("获取投票结果失败");let n=await e.json();c(n||[]);let r=(null==n?void 0:n.reduce((e,t)=>e+t.count,0))||0;h(r),f(null)}catch(e){f(e instanceof Error?e.message:"未知错误")}finally{u(!1)}},[t]);if((0,s.useEffect)(()=>{x()},[x,n]),(0,s.useEffect)(()=>{let e=()=>{x()};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[x]),o)return(0,r.jsx)(a.Zb,{children:(0,r.jsx)(a.aY,{className:"p-6",children:(0,r.jsx)("div",{className:"text-center",children:"正在加载投票结果..."})})});if(d)return(0,r.jsx)(a.Zb,{children:(0,r.jsx)(a.aY,{className:"p-6",children:(0,r.jsx)("div",{className:"text-center text-red-600",children:d})})});if(0===l.length)return(0,r.jsxs)(a.Zb,{children:[(0,r.jsx)(a.Ol,{children:(0,r.jsx)(a.ll,{children:"投票统计"})}),(0,r.jsx)(a.aY,{children:(0,r.jsx)("div",{className:"text-center text-gray-500",children:"暂无投票数据"})})]});let g=l.reduce((e,t)=>{let n=t.tag_subcategories.tag_categories.name;return e[n]||(e[n]=[]),e[n].push(t),e},{});return Object.keys(g).forEach(e=>{g[e].sort((e,t)=>t.count-e.count)}),(0,r.jsxs)(a.Zb,{children:[(0,r.jsxs)(a.Ol,{children:[(0,r.jsx)(a.ll,{children:"投票统计"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["总投票数: ",m]})]}),(0,r.jsxs)(a.aY,{children:[(0,r.jsx)("div",{className:"space-y-6",children:Object.entries(g).map(e=>{let[t,n]=e,s=n.reduce((e,t)=>e+t.count,0);return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 border-b pb-2",children:[t," (",s," 票)"]}),(0,r.jsx)("div",{className:"space-y-2",children:n.map(e=>{let t=(0,i.Fp)(e.count,m);return(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.tag_subcategories.name}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:[e.count," 票 (",t,"%)"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-3 rounded-full transition-all duration-500 shadow-sm",style:{width:"".concat(t,"%")}})}),e.tag_subcategories.description&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:e.tag_subcategories.description})]},e.subcategory_id)})})]},t)})}),m>0&&(0,r.jsxs)("div",{className:"mt-6 pt-4 border-t text-xs text-gray-500",children:["数据更新时间: ",new Date().toLocaleString("zh-CN")]})]})]})}},3448:function(e,t,n){"use strict";n.d(t,{AC:function(){return m},Fp:function(){return g},Sp:function(){return f},cn:function(){return a},i$:function(){return x},j2:function(){return l},mJ:function(){return c},p6:function(){return h},tv:function(){return o},u3:function(){return d},xV:function(){return u},xv:function(){return i}});var r=n(1994),s=n(3335);function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}function i(){{let e=localStorage.getItem("session_id");return e||(e=crypto.randomUUID(),localStorage.setItem("session_id",e),localStorage.setItem("session_created",Date.now().toString())),e}}function l(e,t){let n=t||e.sessionId||i(),r={...e,sessionId:n,timestamp:Date.now()},s=c(),a=s.findIndex(e=>e.moduleId===r.moduleId);a>=0?(r.sessionId=s[a].sessionId,s[a]=r):s.push(r),localStorage.setItem("vote_history",JSON.stringify(s))}function c(){try{let e=localStorage.getItem("vote_history");return e?JSON.parse(e):[]}catch(e){return console.error("读取本地投票历史失败:",e),[]}}function o(e){return c().find(t=>t.moduleId===e)||null}function u(e){return null!==o(e)}function d(e){let t=c().filter(t=>t.moduleId!==e);localStorage.setItem("vote_history",JSON.stringify(t))}function f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=Date.now()-864e5*e,n=c().filter(e=>e.timestamp>t);localStorage.setItem("vote_history",JSON.stringify(n))}function m(){let e=c(),t=e.length,n=new Set(e.map(e=>e.moduleId)).size,r=e.length>0?Math.min(...e.map(e=>e.timestamp)):null;return{totalVotes:t,uniqueModules:n,oldestVote:r?new Date(r):null,sessionId:i()}}function h(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function x(e){return new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function g(e,t){return 0===t?0:Math.round(e/t*100)}}},function(e){e.O(0,[216,744],function(){return e(e.s=6496)}),_N_E=e.O()}]);